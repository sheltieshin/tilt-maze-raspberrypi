<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tilt Maze â€“ Button Control</title>

  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 16px;
      background:#f6f7f9;
      text-align: center;
    }
    h2 { margin-bottom: 12px; }

    button {
      font-size: 20px;
      padding: 16px;
      margin: 6px;
      width: 90px;
      border-radius: 10px;
      border: none;
      background: #1976d2;
      color: white;
    }

    button.control {
      width: 90px;
      height: 90px;
      font-size: 28px;
      background: #455a64;
    }

    button.control:active {
      background: #1e88e5;
    }

    .row {
      display: flex;
      justify-content: center;
    }

    .box {
      margin-top: 14px;
      padding: 12px;
      background:#fff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
  </style>
</head>

<body>
  <h2>ğŸ® Tilt Mazeï¼ˆæŒ‰éµæ§åˆ¶ç‰ˆï¼‰</h2>

  <button id="btnEnable">Enable Control</button>
  <button id="btnPause">Pause</button>
  <button id="btnCenter">Center</button>

  <div class="box">
    <div class="row">
      <button class="control" id="btnUp">â†‘</button>
    </div>
    <div class="row">
      <button class="control" id="btnLeft">â†</button>
      <button class="control" id="btnDown">â†“</button>
      <button class="control" id="btnRight">â†’</button>
    </div>
  </div>

  <div class="box">
    <div>è¼¸å‡º X / Yï¼š<span id="xy">0 , 0</span></div>
    <div>Statusï¼š<span id="status">idle</span></div>
  </div>

<script>
/* ===============================
   å›ºå®šå®‰å…¨å‚¾æ–œé‡ï¼ˆä¸æœƒé£›ï¼‰
   =============================== */
const STEP_X = 0.35;   // å·¦å³å‚¾æ–œé‡
const STEP_Y = 0.45;   // å‰å¾Œå‚¾æ–œé‡ï¼ˆé€šå¸¸è¦å¤§ä¸€é»ï¼‰

let enabled = false;
let paused = false;
let currentX = 0;
let currentY = 0;

const xyEl = document.getElementById('xy');
const statusEl = document.getElementById('status');

async function sendXY(x, y) {
  try {
    const res = await fetch('/api/tilt', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ x, y })
    });
    const data = await res.json();
    statusEl.textContent = `X_PWM=${data.x_pwm} Y_PWM=${data.y_pwm}`;
  } catch {
    statusEl.textContent = 'send error';
  }
}

function updateXY(x, y) {
  if (!enabled || paused) return;
  currentX = x;
  currentY = y;
  xyEl.textContent = `${x.toFixed(2)} , ${y.toFixed(2)}`;
  sendXY(x, y);
}

function stop() {
  updateXY(0, 0);
}

/* ===============================
   Buttons
   =============================== */
document.getElementById('btnEnable').onclick = () => {
  enabled = true;
  statusEl.textContent = 'control enabled';
};

document.getElementById('btnPause').onclick = () => {
  paused = !paused;
  statusEl.textContent = paused ? 'paused' : 'resumed';
  if (paused) stop();
};

document.getElementById('btnCenter').onclick = async () => {
  await fetch('/api/center', { method: 'POST' });
  xyEl.textContent = '0 , 0';
};

/* ===============================
   Direction buttons
   =============================== */
const bindHold = (btn, onDown) => {
  btn.addEventListener('mousedown', onDown);
  btn.addEventListener('touchstart', e => { e.preventDefault(); onDown(); });
  btn.addEventListener('mouseup', stop);
  btn.addEventListener('mouseleave', stop);
  btn.addEventListener('touchend', stop);
};

bindHold(document.getElementById('btnUp'),    () => updateXY(0,  STEP_Y));
bindHold(document.getElementById('btnDown'),  () => updateXY(0, -STEP_Y));
bindHold(document.getElementById('btnLeft'),  () => updateXY(-STEP_X, 0));
bindHold(document.getElementById('btnRight'), () => updateXY( STEP_X, 0));
</script>

</body>
</html>

